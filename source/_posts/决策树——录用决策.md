---
title: 决策树——录用决策
categories:
- DataScience
date: 2020-02-17 02:17:00
---
#   决策树——录用决策

###    1. 准备数据
- ###    pd.read_csv(filepath,header=0) header=i表明用文件第i行数据当标题
```
import numpy as np
import pandas as pd
from sklearn import tree

input_file='D:\Download\DataScienceCourse\PastHires.csv'
df=pd.read_csv(input_file,header=0)
df.head()
```
<br/>
###       df.head()结果视图:
![数据示例](https://wx4.sinaimg.cn/mw1024/b8e57787gy1ggtsuvmk0hj20kc05b3yf.jpg)
<br/>
###    2. 整理数据
- ###    sklearn 要求属性都是数值型,所以要转化整理数据
- ###    dataframe.map(function/dict) 用传参处理dataframe的values,经测试不处理index
- ###    联想到之前的练习,可以用dataframe\['colum']=pandas.Categorical(dataframe\['colum']).codes 自动编码,返回Categorical类型,也可以直接赋值给dataframe的列
- ###    关于dict,注意自己访问dict时,用不存在的key访问会报错,在map里会返回值NaN

```
d={'Y':1,'N':0}
df['Hired']=df['Hired'].map(d)
df['Employed?']=df['Employed?'].map(d)
df['Interned']=df['Interned'].map(d)
df['Top-tier school']=df['Top-tier school'].map(d)
d={'BS':0,'MS':1,'PhD':2}
df['Level of Education']=df['Level of Education'].map(d)

df.head()
```
<br/>
###   处理后视图:
![处理后数据](https://wx1.sinaimg.cn/mw1024/b8e57787gy1ggtsuunhz1j20jy060a9z.jpg)

###    3. 分离决策属性和目标列
  ###      分开特征组和目标组,作为参数传给fit拟合函数即可
```
features=list(df.columns[:6])# 列名元组
y=df["Hired"]
x=df[features]
clf=tree.DecisionTreeClassifier()
clf=clf.fit(x,y)

```
<br/>
###    4. 显示图形数据
>这里 IPython !!不是Ipython!!!IP都要大写!!!!搞了一个小时找各种BUG为啥能用IPython不能import,装了卸卸了装path疯狂加就是不能import,结果是因为P是大写....
----------------------
<br/>
- ###    create_png这一步报错"GraphViz's executables not found" ————额外安装GraphViz软件,并且添加path
- ###    StringIO在内存在读写string,有点类似于文件机制?只不过不是访问文件,是访问内存缓冲区.f=StringIO(),用f进行各种操作比如f.write("this is a string"), f.getvalue() 返回
- ###    sklearn.tree.export_graphviz（decision_tree，out_file = None,feature_names = None,……) 将decision_tree 转换为GraphViz dot 格式内容的字符串,out_file不为空就输出到out_file,否则作为返回值返回.
> 总之输出的是Graphviz自己的东西,传给它自己的功能调用就好了...

- ###    pydotplus.graph_from_dot_data(data) 解析dot格式的data,返回含有图信息的Dot类对象

- ###    决策树中gini是熵值,决策树目标让gini=0,即做出一个分类决策
- ###    samples是包含的样本数
- ###    value[i,j]是样本处理结果,在这个录用决策中是i个未录用,j个录用
```
from IPython.display import Image
from sklearn.externals.six import StringIO
import pydotplus

dot_data=StringIO()
tree.export_graphviz(clf,out_file=dot_data,feature_names=features)
graph=pydotplus.graph_from_dot_data(dot_data.getvalue())
Image(graph.create_png())
```
<br/>
###    显示结果:
![决策树](https://wx1.sinaimg.cn/mw1024/b8e57787gy1ggtsuv5rn6j20ff0i2q37.jpg)

###    集成学习——随机森林

###    一棵决策树可能会对样本过拟合,所以用随机森林投票
- ###    注意predict传参要穿二维数组,即使只想预测一组数据也要是二维形式
```
from sklearn.ensemble import RandomForestClassifier
clf=RandomForestClassifier(n_estimators=10)# 10棵
clf=clf.fit(x,y)
# 预测传参要穿二维数组,即使只想预测一组数据也要是二维形式
print(clf.predict([[10,1,4,0,0,0],[10,0,4,0,0,0],[10,0,4,0,0,0],[10,0,4,0,0,0],[10,0,4,0,0,0]]))
```
<br/>
<br/>
-----------------------------------------------

#  另附学代码惨痛反思:
###    以后学敲代码报错 先!
###    看!教程!代码!很多时候不是自己环境问题,说不定只是! 包升级了! 书印错了! 一些乱七八糟的!
